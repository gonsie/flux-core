

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>flux_rpc(3) &mdash; flux-core  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="flux_send(3)" href="flux_send.html" />
    <link rel="prev" title="flux_response_decode(3)" href="flux_response_decode.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> flux-core
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Manual pages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../man1/index.html">man1</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">man3</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="flux_attr_get.html">flux_attr_get(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_aux_set.html">flux_aux_set(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_child_watcher_create.html">flux_child_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_content_load.html">flux_content_load(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_core_version.html">flux_core_version(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_event_decode.html">flux_event_decode(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_event_publish.html">flux_event_publish(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_event_subscribe.html">flux_event_subscribe(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_fatal_set.html">flux_fatal_set(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_fd_watcher_create.html">flux_fd_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_flags_set.html">flux_flags_set(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_future_and_then.html">flux_future_and_then(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_future_create.html">flux_future_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_future_get.html">flux_future_get(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_future_wait_all_create.html">flux_future_wait_all_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_get_rank.html">flux_get_rank(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_get_reactor.html">flux_get_reactor(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_handle_watcher_create.html">flux_handle_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_idle_watcher_create.html">flux_idle_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_kvs_commit.html">flux_kvs_commit(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_kvs_copy.html">flux_kvs_copy(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_kvs_getroot.html">flux_kvs_getroot(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_kvs_lookup.html">flux_kvs_lookup(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_kvs_namespace_create.html">flux_kvs_namespace_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_kvs_txn_create.html">flux_kvs_txn_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_log.html">flux_log(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_msg_cmp.html">flux_msg_cmp(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_msg_encode.html">flux_msg_encode(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_msg_handler_addvec.html">flux_msg_handler_addvec(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_msg_handler_create.html">flux_msg_handler_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_open.html">flux_open(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_periodic_watcher_create.html">flux_periodic_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_pollevents.html">flux_pollevents(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_reactor_create.html">flux_reactor_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_reactor_now.html">flux_watcher_now(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_recv.html">flux_recv(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_request_decode.html">flux_request_decode(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_request_encode.html">flux_request_encode(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_requeue.html">flux_requeue(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_respond.html">flux_respond(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_response_decode.html">flux_response_decode(3)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">flux_rpc(3)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synopsis">SYNOPSIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">DESCRIPTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="#request-options">REQUEST OPTIONS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#response-options">RESPONSE OPTIONS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#premature-destruction">PREMATURE DESTRUCTION</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cancellation">CANCELLATION</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encoding-json-payloads">ENCODING JSON PAYLOADS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decoding-json-payloads">DECODING JSON PAYLOADS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#return-value">RETURN VALUE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#errors">ERRORS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">EXAMPLES</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resources">RESOURCES</a></li>
<li class="toctree-l3"><a class="reference internal" href="#see-also">SEE ALSO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="flux_send.html">flux_send(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_add_completion_ref.html">flux_shell_add_completion_ref(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_add_event_context.html">flux_shell_add_event_context(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_add_event_handler.html">flux_shell_add_event_handler(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_aux_set.html">flux_shell_aux_set(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_current_task.html">flux_shell_current_task(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_get_flux.html">flux_shell_get_flux(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_get_info.html">flux_shell_get_info(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_getenv.html">flux_shell_getenv(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_getopt.html">flux_shell_getopt(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_killall.html">flux_shell_killall(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_log.html">flux_shell_log(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_plugstack_call.html">flux_shell_plugstack_call(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_rpc_pack.html">flux_shell_rpc_pack(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_service_register.html">flux_shell_service_register(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_task_channel_subscribe.html">flux_shell_task_channel_subscribe(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_task_get_info.html">flux_shell_task_get_info(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_shell_task_subprocess.html">flux_shell_task_subprocess(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_signal_watcher_create.html">flux_signal_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_stat_watcher_create.html">flux_stat_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_timer_watcher_create.html">flux_timer_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_watcher_start.html">flux_watcher_start(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flux_zmq_watcher_create.html">flux_zmq_watcher_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="idset_create.html">idset_create(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="idset_encode.html">idset_encode(3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="JSON_PACK.html">ENCODING JSON PAYLOADS</a></li>
<li class="toctree-l2"><a class="reference internal" href="JSON_UNPACK.html">DECODING JSON PAYLOADS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../man5/index.html">man5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../man7/index.html">man7</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bindings/python/flux.html">flux package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bindings/python/flux.core.html">flux.core package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bindings/python/modules.html">python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bindings/python/setup.html">setup module</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">flux-core</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">man3</a> &raquo;</li>
        
      <li>flux_rpc(3)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/man3/flux_rpc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="flux-rpc-3">
<h1>flux_rpc(3)<a class="headerlink" href="#flux-rpc-3" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>SYNOPSIS<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;flux/core.h&gt;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flux_future_t</span> <span class="o">*</span><span class="n">flux_rpc</span> <span class="p">(</span><span class="n">flux_t</span> <span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">topic</span><span class="p">,</span>
                         <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
                         <span class="n">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flux_future_t</span> <span class="o">*</span><span class="n">flux_rpc_pack</span> <span class="p">(</span><span class="n">flux_t</span> <span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">topic</span><span class="p">,</span>
                              <span class="n">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">,</span>
                              <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flux_future_t</span> <span class="o">*</span><span class="n">flux_rpc_raw</span> <span class="p">(</span><span class="n">flux_t</span> <span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">topic</span><span class="p">,</span>
                             <span class="n">const</span> <span class="n">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span> <span class="nb">len</span><span class="p">,</span>
                             <span class="n">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flux_future_t</span> <span class="o">*</span><span class="n">flux_rpc_message</span> <span class="p">(</span><span class="n">flux_t</span> <span class="o">*</span><span class="n">h</span><span class="p">,</span>
                                 <span class="n">const</span> <span class="n">flux_msg_t</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
                                 <span class="n">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">flux_rpc_get</span> <span class="p">(</span><span class="n">flux_future_t</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">s</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">flux_rpc_get_unpack</span> <span class="p">(</span><span class="n">flux_future_t</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="o">...</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">flux_rpc_get_raw</span> <span class="p">(</span><span class="n">flux_future_t</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span>
                      <span class="n">const</span> <span class="n">void</span> <span class="o">**</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span> <span class="o">*</span><span class="nb">len</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>DESCRIPTION<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>A remote procedure call (RPC) consists of a matched request and
response message exchanged with a Flux service. <code class="docutils literal notranslate"><span class="pre">flux_rpc()</span></code>,
<code class="docutils literal notranslate"><span class="pre">flux_rpc_pack()</span></code>, and <code class="docutils literal notranslate"><span class="pre">flux_rpc_raw()</span></code> encode and send a request message
via Flux broker handle <em>h</em> to a Flux service identified by <em>topic</em>
and <em>nodeid</em>. A <code class="docutils literal notranslate"><span class="pre">flux_future_t</span></code> object is returned which acts as a handle
for synchronization and a container for the response message which in
turn contains the RPC result.</p>
<p>A lower-level variant of <code class="docutils literal notranslate"><span class="pre">flux_rpc()</span></code>, <code class="docutils literal notranslate"><span class="pre">flux_rpc_message()</span></code> accepts a
pre-created request message, assigning <em>nodeid</em> and matchtag according
to <em>flags</em>.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_future_then(3)</span></code> may be used to register a reactor callback
(continuation) to be called once the response has been received.
<code class="docutils literal notranslate"><span class="pre">flux_future_wait_for(3)</span></code> may be used to block until the
response has been received. Both accept an optional timeout.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc_get()</span></code>, <code class="docutils literal notranslate"><span class="pre">flux_rpc_get_unpack()</span></code>, and <code class="docutils literal notranslate"><span class="pre">flux_rpc_get_raw()</span></code>
decode the RPC result. Internally, they call <code class="docutils literal notranslate"><span class="pre">flux_future_get()</span></code>
to access the response message stored in the future. If the response
message has not yet been received, these functions block until it is,
or an error occurs.</p>
</div>
<div class="section" id="request-options">
<h2>REQUEST OPTIONS<a class="headerlink" href="#request-options" title="Permalink to this headline">¶</a></h2>
<p>The request message is encoded and sent with or without a payload
using one of the three <code class="docutils literal notranslate"><span class="pre">flux_rpc()</span></code> variants.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc()</span></code> attaches <em>s</em>, a NULL terminated string, as request
payload. If NULL, the request is encoded without a payload.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc_pack()</span></code> attaches a JSON payload encoded as a NULL terminated
string using Jansson <code class="docutils literal notranslate"><span class="pre">json_pack()</span></code> style arguments (see below).</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc_raw()</span></code> attaches a raw payload <em>data</em> of length <em>len</em>, in bytes.
If <em>data</em> is NULL, the request is encoded without a payload.</p>
<p><em>nodeid</em> affects request routing, and must be set to one of the following
values:</p>
<dl class="simple">
<dt>FLUX_NODEID_ANY</dt><dd><p>The request is routed to the first matching service instance.</p>
</dd>
<dt>FLUX_NODEID_UPSTREAM</dt><dd><p>The request is routed to the first matching service instance,
skipping over the sending rank.</p>
</dd>
<dt>integer</dt><dd><p>The request is routed to a specific rank.</p>
</dd>
</dl>
<p><em>flags</em> may be zero or:</p>
<dl class="simple">
<dt>FLUX_RPC_NORESPONSE</dt><dd><p>No response is expected. The request will not be assigned a matchtag,
and the returned flux_future_t is immediately fulfilled, and may simply
be destroyed.</p>
</dd>
<dt>FLUX_RPC_STREAMING</dt><dd><p>The RPC is for a service that may send zero or more non-error responses,
and a final error response. ENODATA should be interpreted as a non-error
end-of-stream sentinel.</p>
</dd>
</dl>
</div>
<div class="section" id="response-options">
<h2>RESPONSE OPTIONS<a class="headerlink" href="#response-options" title="Permalink to this headline">¶</a></h2>
<p>The response message is stored in the future when the future is fulfilled.
At that time it is decoded with <code class="docutils literal notranslate"><span class="pre">flux_response_decode(3)</span></code>. If it cannot
be decoded, or if the service returned an error, the future is fulfilled
with an error. Otherwise it is fulfilled with the response message.
If there was an error, <code class="docutils literal notranslate"><span class="pre">flux_future_get()</span></code> or the <code class="docutils literal notranslate"><span class="pre">flux_rpc_get()</span></code> variants
return an error.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc_get()</span></code> sets <em>s</em> (if non-NULL) to the NULL-terminated string
payload contained in the RPC response. If there was no payload, <em>s</em>
is set to NULL.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc_get_unpack()</span></code> decodes the NULL-terminated string payload as JSON
using Jansson <code class="docutils literal notranslate"><span class="pre">json_unpack()</span></code> style arguments (see below). It is an error
if there is no payload, or if the payload is not JSON.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc_get_raw()</span></code> assigns the raw payload of the RPC response message
to <em>data</em> and its length to <em>len</em>. If there is no payload, this function
will fail.</p>
</div>
<div class="section" id="premature-destruction">
<h2>PREMATURE DESTRUCTION<a class="headerlink" href="#premature-destruction" title="Permalink to this headline">¶</a></h2>
<p>If a regular RPC future is destroyed before its response is received,
the matchtag allocated to it is not immediately returned to the pool
for reuse. If an unclaimed response subsequently arrives with that
matchtag, it is returned to the pool then.</p>
<p>If a <strong>streaming</strong> RPC future is destroyed before its terminating response
is received, its matchtag is only returned to the pool when an unclaimed
<strong>error</strong> response is received. Non-error responses are ignored.</p>
<p>It is essential that services which return multiple responses verify that
requests were made with the FLUX_RPC_STREAMING flag and return an immediate
EPROTO error if they were not. See flux_respond(3).</p>
</div>
<div class="section" id="cancellation">
<h2>CANCELLATION<a class="headerlink" href="#cancellation" title="Permalink to this headline">¶</a></h2>
<p>Flux RFC 6 does not currently specify a cancellation protocol for an
individual RPC, but does stipulate that an RPC may be canceled if a disconnect
message is received, as is automatically generated by the local connector
upon client disconnection.</p>
</div>
<div class="section" id="encoding-json-payloads">
<h2>ENCODING JSON PAYLOADS<a class="headerlink" href="#encoding-json-payloads" title="Permalink to this headline">¶</a></h2>
<p>Flux API functions that are based on Jansson's json_pack()
accept the following tokens in their format string.
The type in parenthesis denotes the resulting JSON type, and
the type in brackets (if any) denotes the C type that is expected as
the corresponding argument or arguments.</p>
<dl class="simple">
<dt><strong>s</strong> (string)['const char *']</dt><dd><p>Convert a null terminated UTF-8 string to a JSON string.</p>
</dd>
<dt><strong>s#</strong> (string)['const char *', 'int']</dt><dd><p>Convert a UTF-8 buffer of a given length to a JSON string.</p>
</dd>
<dt><strong>s%</strong> (string)['const char *', 'size_t']</dt><dd><p>Like <strong>s#</strong> but the length argument is of type size_t.</p>
</dd>
<dt><strong>+</strong> ['const char *']</dt><dd><p>Like <strong>s</strong>, but concatenate to the previous string.
Only valid after a string.</p>
</dd>
<dt><strong>+#</strong> ['const char *', 'int']</dt><dd><p>Like <strong>s#</strong>, but concatenate to the previous string.
Only valid after a string.</p>
</dd>
<dt><strong>+%</strong> ['const char *', 'size_t']</dt><dd><p>Like <strong>+#</strong>, but the length argument is of type size_t.</p>
</dd>
<dt><strong>n</strong> (null)</dt><dd><p>Output a JSON null value. No argument is consumed.</p>
</dd>
<dt><strong>b</strong> (boolean)['int']</dt><dd><p>Convert a C int to JSON boolean value. Zero is converted to
<em>false</em> and non-zero to <em>true</em>.</p>
</dd>
<dt><strong>i</strong> (integer)['int']</dt><dd><p>Convert a C int to JSON integer.</p>
</dd>
<dt><strong>I</strong> (integer)['int64_t']</dt><dd><p>Convert a C int64_t to JSON integer.
Note: Jansson expects a json_int_t here without committing to a size,
but Flux guarantees that this is a 64-bit integer.</p>
</dd>
<dt><strong>f</strong> (real)['double']</dt><dd><p>Convert a C double to JSON real.</p>
</dd>
<dt><strong>o</strong> (any value)['json_t *']</dt><dd><p>Output any given JSON value as-is. If the value is added to an array
or object, the reference to the value passed to <strong>o</strong> is stolen by the
container.</p>
</dd>
<dt><strong>O</strong> (any value)['json_t *']</dt><dd><p>Like <strong>o</strong>, but the argument's reference count is incremented. This
is useful if you pack into an array or object and want to keep the reference
for the JSON value consumed by <strong>O</strong> to yourself.</p>
</dd>
<dt><strong>[fmt]</strong> (array)</dt><dd><p>Build an array with contents from the inner format string. <strong>fmt</strong> may
contain objects and arrays, i.e. recursive value building is supported.</p>
</dd>
<dt><strong>{fmt}</strong> (object)</dt><dd><p>Build an object with contents from the inner format string <strong>fmt</strong>.
The first, third, etc. format specifier represent a key, and must be a
string as object keys are always strings. The second, fourth, etc.
format specifier represent a value. Any value may be an object or array,
i.e. recursive value building is supported.</p>
</dd>
</dl>
<p>Whitespace, <strong>:</strong> (colon) and <strong>,</strong> (comma) are ignored.</p>
<p>These descriptions came from the Jansson 2.6 manual.</p>
<p>See also: <a class="reference external" href="http://jansson.readthedocs.io/en/2.6/apiref.html#building-values">Jansson API: Building Values</a></p>
</div>
<div class="section" id="decoding-json-payloads">
<h2>DECODING JSON PAYLOADS<a class="headerlink" href="#decoding-json-payloads" title="Permalink to this headline">¶</a></h2>
<p>Flux API functions that are based on Jansson's json_unpack()
accept the following tokens in their format string.
The type in parenthesis denotes the resulting JSON type, and
the type in brackets (if any) denotes the C type that is expected as
the corresponding argument or arguments.</p>
<dl class="simple">
<dt><strong>s</strong> (string)['const char *']</dt><dd><p>Convert a JSON string to a pointer to a null terminated UTF-8 string.
The resulting string is extracted by using 'json_string_value()'
internally, so it exists as long as there are still references to the
corresponding JSON string.</p>
</dd>
<dt><strong>n</strong> (null)</dt><dd><p>Expect a JSON null value. Nothing is extracted.</p>
</dd>
<dt><strong>b</strong> (boolean)['int']</dt><dd><p>Convert a JSON boolean value to a C int, so that <em>true</em> is converted to 1
and <em>false</em> to 0.</p>
</dd>
<dt><strong>i</strong> (integer)['int']</dt><dd><p>Convert a JSON integer to a C int.</p>
</dd>
<dt><strong>I</strong> (integer)['int64_t']</dt><dd><p>Convert a JSON integer to a C int64_t.
Note: Jansson expects a json_int_t here without committing to a size,
but Flux guarantees that this is a 64-bit integer.</p>
</dd>
<dt><strong>f</strong> (real)['double']</dt><dd><p>Convert JSON real to a C double.</p>
</dd>
<dt><strong>F</strong> (real)['double']</dt><dd><p>Convert JSON number (integer or real) to a C double.</p>
</dd>
<dt><strong>o</strong> (any value)['json_t *']</dt><dd><p>Store a JSON value, with no conversion, to a json_t pointer.</p>
</dd>
<dt><strong>O</strong> (any value)['json_t *']</dt><dd><p>Like <strong>o</strong>, but the JSON value's reference count is incremented.</p>
</dd>
<dt><strong>[fmt]</strong> (array)</dt><dd><p>Convert each item in the JSON array according to the inner format
string. <strong>fmt</strong> may contain objects and arrays, i.e. recursive value
extraction is supported.</p>
</dd>
<dt><strong>{fmt}</strong> (object)</dt><dd><p>Convert each item in the JSON object according to the inner format
string <strong>fmt</strong>. The first, third, etc. format specifier represent a
key, and must by <strong>s</strong>. The corresponding argument to unpack functions
is read as the object key. The second, fourth, etc. format specifier
represent a value and is written to the address given as the corresponding
argument. Note that every other argument is read from and every other
is written to. <strong>fmt</strong> may contain objects and arrays as values, i.e.
recursive value extraction is supported. Any <strong>s</strong> representing a key
may be suffixed with <strong>?</strong> to make the key optional. If the key is not
found, nothing is extracted.</p>
</dd>
<dt><strong>!</strong></dt><dd><p>This special format specifier is used to enable the check that all
object and array items are accessed, on a per-value basis. It must
appear inside an array or object as the last format specifier before
the closing bracket or brace.</p>
</dd>
</dl>
<p>Whitespace, <strong>:</strong> (colon) and <strong>,</strong> (comma) are ignored.</p>
<p>These descriptions came from the Jansson 2.6 manual.</p>
<p>See also: <a class="reference external" href="http://jansson.readthedocs.io/en/2.6/apiref.html#parsing-and-validating-values">Jansson API: Parsing and Validating Values</a></p>
</div>
<div class="section" id="return-value">
<h2>RETURN VALUE<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc()</span></code>, <code class="docutils literal notranslate"><span class="pre">flux_rpc_pack()</span></code>, and <code class="docutils literal notranslate"><span class="pre">flux_rpc_raw()</span></code> return a flux_future_t
object on success. On error, NULL is returned, and errno is set appropriately.</p>
<p><code class="docutils literal notranslate"><span class="pre">flux_rpc_get()</span></code>, <code class="docutils literal notranslate"><span class="pre">flux_rpc_get_unpack()</span></code>, and <code class="docutils literal notranslate"><span class="pre">flux_rpc_get_raw()</span></code> return
zero on success. On error, -1 is returned, and errno is set appropriately.</p>
</div>
<div class="section" id="errors">
<h2>ERRORS<a class="headerlink" href="#errors" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>ENOSYS</dt><dd><p>Service is not available (misspelled topic string, module not loaded, etc),
or flux_t handle has no send operation.</p>
</dd>
<dt>EINVAL</dt><dd><p>Some arguments were invalid.</p>
</dd>
<dt>EPROTO</dt><dd><p>A request was malformed, the FLUX_RPC_STREAMING flag was
omitted on a request to a service that may send multiple responses,
or other protocol error occurred.</p>
</dd>
</dl>
</div>
<div class="section" id="examples">
<h2>EXAMPLES<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>This example performs a synchronous RPC with the broker's &quot;attr.get&quot;
service to obtain the broker's rank.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#include &lt;flux/core.h&gt;
#include &quot;src/common/libutil/log.h&quot;

int main (int argc, char **argv)
{
    flux_t *h;
    flux_future_t *f;
    const char *rankstr;

    if (!(h = flux_open (NULL, 0)))
        log_err_exit (&quot;flux_open&quot;);

    if (!(f = flux_rpc_pack (h, &quot;attr.get&quot;, FLUX_NODEID_ANY, 0,
		             &quot;{s:s}&quot;, &quot;name&quot;, &quot;rank&quot;)))
        log_err_exit (&quot;flux_rpc_pack&quot;);

    if (flux_rpc_get_unpack (f, &quot;{s:s}&quot;, &quot;value&quot;, &amp;rankstr) &lt; 0)
        log_err_exit (&quot;flux_rpc_get_unpack&quot;);

    printf (&quot;rank is %s\n&quot;, rankstr);
    flux_future_destroy (f);

    flux_close (h);
    return (0);
}
</pre></div>
</div>
<p>This example registers a continuation to do the same thing asynchronously.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#include &lt;flux/core.h&gt;
#include &quot;src/common/libutil/log.h&quot;

void continuation (flux_future_t *f, void *arg)
{
    const char *rankstr;

    if (flux_rpc_get_unpack (f, &quot;{s:s}&quot;, &quot;value&quot;, &amp;rankstr) &lt; 0)
        log_err_exit (&quot;flux_rpc_get_unpack&quot;);

    printf (&quot;rank is %s\n&quot;, rankstr);
    flux_future_destroy (f);
}

int main (int argc, char **argv)
{
    flux_t *h;
    flux_future_t *f;

    if (!(h = flux_open (NULL, 0)))
        log_err_exit (&quot;flux_open&quot;);

    if (!(f = flux_rpc_pack (h, &quot;attr.get&quot;, FLUX_NODEID_ANY, 0,
		             &quot;{s:s}&quot;, &quot;name&quot;, &quot;rank&quot;)))
        log_err_exit (&quot;flux_rpc_pack&quot;);

    if (flux_future_then (f, -1., continuation, NULL) &lt; 0)
        log_err_exit (&quot;flux_future_then&quot;);

    if (flux_reactor_run (flux_get_reactor (h), 0) &lt; 0)
        log_err_exit (&quot;flux_reactor_run&quot;);

    flux_close (h);
    return (0);
}
</pre></div>
</div>
</div>
<div class="section" id="resources">
<h2>RESOURCES<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<p>Github: <a class="reference external" href="http://github.com/flux-framework">http://github.com/flux-framework</a></p>
</div>
<div class="section" id="see-also">
<h2>SEE ALSO<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>flux_future_get(3), flux_respond(3)</p>
<p><a class="reference external" href="https://github.com/flux-framework/rfc/blob/master/spec_6.rst">RFC 6: Flux
Remote Procedure Call Protocol</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="flux_send.html" class="btn btn-neutral float-right" title="flux_send(3)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="flux_response_decode.html" class="btn btn-neutral float-left" title="flux_response_decode(3)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Copyright 2014 Lawrence Livermore National Security, LLC and Flux developers.

SPDX-License-Identifier: LGPL-3.0

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>